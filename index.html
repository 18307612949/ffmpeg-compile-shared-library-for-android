<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Ffmpeg for android shared library by dxjia</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Ffmpeg for android shared library</h1>
      <h2 class="project-tagline">移植ffmpeg到android，编译可用于jni调用的so库.</h2>
      <a href="https://github.com/dxjia/ffmpeg-for-android-shared-library" class="btn">View on GitHub</a>
      <a href="https://github.com/dxjia/ffmpeg-for-android-shared-library/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/dxjia/ffmpeg-for-android-shared-library/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="ffmpeg-for-android-shared-library" class="anchor" href="#ffmpeg-for-android-shared-library" aria-hidden="true"><span class="octicon octicon-link"></span></a>ffmpeg for android shared library</h1>

<p>移植ffmpeg到android，编译可用于jni调用的so库.<br>
  编译出的so在android apk中的使用参考我的另一个项目<a href="https://github.com/dxjia/ffmpeg-jni-sample">ffmpeg-jni-sample</a></p>

<h1>
<a id="环境" class="anchor" href="#%E7%8E%AF%E5%A2%83" aria-hidden="true"><span class="octicon octicon-link"></span></a>环境</h1>

<p>ubuntu 12.04LTS x86_64<br>
  android-ndk64-r10-linux-x86_64<br>
  ffmpeg 2.6.2<br>
  我是在ubuntu下进行移植的，windows下应该也可以，没有尝试过。</p>

<h1>
<a id="获取代码" class="anchor" href="#%E8%8E%B7%E5%8F%96%E4%BB%A3%E7%A0%81" aria-hidden="true"><span class="octicon octicon-link"></span></a>获取代码</h1>

<pre><code>  git clone git@github.com:dxjia/ffmpeg-for-android-shared-library.git
</code></pre>

<h1>
<a id="使用" class="anchor" href="#%E4%BD%BF%E7%94%A8" aria-hidden="true"><span class="octicon octicon-link"></span></a>使用</h1>

<h2>
<a id="step-1" class="anchor" href="#step-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 1</h2>

<p>安装android linux NDK以及SDK，并配置环境变量；<br>
从<a href="http://ffmpeg.org/">ffmpeg官网</a>下载ffmpeg源码包;也可以直接使用我本项目中的ffmpeg源码，我所使用的是2.6.2版本<br></p>

<h2>
<a id="step-2" class="anchor" href="#step-2" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 2</h2>

<p>在ffmpeg源码目录下新建build_android.sh文件，并修改build_android.sh中的 TMPDIR、NDK、SYSROOT、TOOLCHAIN、PREFIX变量为自己的具体情况，具体如下：<br></p>

<h5>
<a id="1指定零时目录" class="anchor" href="#1%E6%8C%87%E5%AE%9A%E9%9B%B6%E6%97%B6%E7%9B%AE%E5%BD%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>1.指定零时目录</h5>

<pre><code>export TMPDIR=/home/djia/tmpdir
</code></pre>

<p>必须要有，ffmpeg编译要用；<br></p>

<h5>
<a id="2指定ndk路径" class="anchor" href="#2%E6%8C%87%E5%AE%9Andk%E8%B7%AF%E5%BE%84" aria-hidden="true"><span class="octicon octicon-link"></span></a>2.指定NDK路径</h5>

<pre><code>NDK=/home/djia/android/android-ndk-r10
</code></pre>

<h5>
<a id="3指定使用ndk-platform版本" class="anchor" href="#3%E6%8C%87%E5%AE%9A%E4%BD%BF%E7%94%A8ndk-platform%E7%89%88%E6%9C%AC" aria-hidden="true"><span class="octicon octicon-link"></span></a>3.指定使用NDK Platform版本</h5>

<pre><code>SYSROOT=$NDK/platforms/android-16/arch-arm/
</code></pre>

<p>这里指定的ndk platform的路径，一定要<code>选择比你的目标机器使用的版本低的</code>，比如你的手机是android-15版本，那么就选择低于15的<br></p>

<h5>
<a id="4指定编译工具链" class="anchor" href="#4%E6%8C%87%E5%AE%9A%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7%E9%93%BE" aria-hidden="true"><span class="octicon octicon-link"></span></a>4.指定编译工具链</h5>

<pre><code>TOOLCHAIN=/home/djia/android/android-ndk-r10/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64
</code></pre>

<h5>
<a id="5指定编译后的安装目录" class="anchor" href="#5%E6%8C%87%E5%AE%9A%E7%BC%96%E8%AF%91%E5%90%8E%E7%9A%84%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95" aria-hidden="true"><span class="octicon octicon-link"></span></a>5.指定编译后的安装目录</h5>

<pre><code>PREFIX=/root/workspace/ffmpeg_shared_compile/dxjia_ffmpeg_install
</code></pre>

<p>这个目录是ffmpeg编译后的so的输出目录，会有一个include和lib文件夹生成在这里，这也是我们之后要在android apk中使用的.<br>
<br></p>

<h5>
<a id="build_androidsh示例" class="anchor" href="#build_androidsh%E7%A4%BA%E4%BE%8B" aria-hidden="true"><span class="octicon octicon-link"></span></a>build_android.sh示例</h5>

<p>可以修改该文件来控制ffmpeg的编译config来达到自己想要的库文件，我这里为了得到动态链接库，--enable-shared，并--disable-static，我开放了所有的编解码器，如果有不需要的，可以通过--disable-coder和--disable-decoder来指定，具体查看ffmpeg文档.</p>

<div class="highlight highlight-java"><pre>#<span class="pl-k">!</span><span class="pl-k">/</span>bin<span class="pl-k">/</span>bash
export <span class="pl-c1">TMPDIR</span><span class="pl-k">=</span><span class="pl-k">/</span>home<span class="pl-k">/</span>djia<span class="pl-k">/</span>tmpdir
<span class="pl-c1">NDK</span><span class="pl-k">=</span><span class="pl-k">/</span>home<span class="pl-k">/</span>djia<span class="pl-k">/</span>android<span class="pl-k">/</span>android<span class="pl-k">-</span>ndk<span class="pl-k">-</span>r10
<span class="pl-c1">SYSROOT</span><span class="pl-k">=</span>$<span class="pl-c1">NDK</span><span class="pl-k">/</span>platforms<span class="pl-k">/</span>android<span class="pl-k">-</span><span class="pl-c1">16</span><span class="pl-k">/</span>arch<span class="pl-k">-</span>arm<span class="pl-k">/</span>
<span class="pl-c1">TOOLCHAIN</span><span class="pl-k">=</span><span class="pl-k">/</span>home<span class="pl-k">/</span>djia<span class="pl-k">/</span>android<span class="pl-k">/</span>android<span class="pl-k">-</span>ndk<span class="pl-k">-</span>r10<span class="pl-k">/</span>toolchains<span class="pl-k">/</span>arm<span class="pl-k">-</span>linux<span class="pl-k">-</span>androideabi<span class="pl-k">-</span><span class="pl-c1">4.9</span><span class="pl-k">/</span>prebuilt<span class="pl-k">/</span>linux<span class="pl-k">-</span>x86_64
function build_one
{
<span class="pl-c1">.</span><span class="pl-k">/</span>configure \
<span class="pl-k">--</span>prefix<span class="pl-k">=</span>$<span class="pl-c1">PREFIX</span> \
<span class="pl-k">--</span>enable<span class="pl-k">-</span>shared \
<span class="pl-k">--</span>disable<span class="pl-k">-</span><span class="pl-k">static</span> \
<span class="pl-k">--</span>disable<span class="pl-k">-</span>doc \
<span class="pl-k">--</span>disable<span class="pl-k">-</span>ffmpeg \
<span class="pl-k">--</span>disable<span class="pl-k">-</span>ffplay \
<span class="pl-k">--</span>disable<span class="pl-k">-</span>ffprobe \
<span class="pl-k">--</span>disable<span class="pl-k">-</span>ffserver \
<span class="pl-k">--</span>disable<span class="pl-k">-</span>doc \
<span class="pl-k">--</span>disable<span class="pl-k">-</span>symver \
<span class="pl-k">--</span>enable<span class="pl-k">-</span>small \
<span class="pl-k">--</span>cross<span class="pl-k">-</span>prefix<span class="pl-k">=</span>$<span class="pl-c1">TOOLCHAIN</span><span class="pl-k">/</span>bin<span class="pl-k">/</span>arm<span class="pl-k">-</span>linux<span class="pl-k">-</span>androideabi<span class="pl-k">-</span> \
<span class="pl-k">--</span>target<span class="pl-k">-</span>os<span class="pl-k">=</span>linux \
<span class="pl-k">--</span>arch<span class="pl-k">=</span>arm \
<span class="pl-k">--</span>enable<span class="pl-k">-</span>cross<span class="pl-k">-</span>compile \
<span class="pl-k">--</span>sysroot<span class="pl-k">=</span>$<span class="pl-c1">SYSROOT</span> \
<span class="pl-k">--</span>extra<span class="pl-k">-</span>cflags<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>-Os -fpic $ADDI_CFLAGS<span class="pl-pds">"</span></span> \
<span class="pl-k">--</span>extra<span class="pl-k">-</span>ldflags<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>$ADDI_LDFLAGS<span class="pl-pds">"</span></span> \
$<span class="pl-c1">ADDITIONAL_CONFIGURE_FLAG</span>
make clean
make
make install
}
<span class="pl-c1">CPU</span><span class="pl-k">=</span>arm
<span class="pl-c1">PREFIX</span><span class="pl-k">=</span><span class="pl-k">/</span>root<span class="pl-k">/</span>workspace<span class="pl-k">/</span>ffmpeg_shared_compile<span class="pl-k">/</span>dxjia_ffmpeg_install
<span class="pl-c1">ADDI_CFLAGS</span><span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>-marm<span class="pl-pds">"</span></span>
build_one</pre></div>

<h2>
<a id="step-3" class="anchor" href="#step-3" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 3</h2>

<pre><code>cd source/ffmpeg
./build_andrioid.sh
</code></pre>

<h2>
<a id="step-4" class="anchor" href="#step-4" aria-hidden="true"><span class="octicon octicon-link"></span></a>Step 4</h2>

<p>等待一段时间后，会在 $PREFIX 目录下生成 include和lib两个文件夹，将lib文件夹中的 pkgconfig 目录和so的链接文件删除，只保留so文件，然后将include 和lib两个目录一起copy到你的apk jni下去编译，具体请参考我的另外一个项目<a href="https://github.com/dxjia/ffmpeg-jni-sample">ffmpeg-jni-sample</a></p>

<h1>
<a id="reference--thanks" class="anchor" href="#reference--thanks" aria-hidden="true"><span class="octicon octicon-link"></span></a>Reference &amp; Thanks</h1>

<p><a href="https://github.com/roman10/android-ffmpeg-tutorial">android-ffmpeg-tutorial</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/dxjia/ffmpeg-for-android-shared-library">Ffmpeg for android shared library</a> is maintained by <a href="https://github.com/dxjia">dxjia</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>

